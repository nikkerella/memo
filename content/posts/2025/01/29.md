---
title: Jan 29, 2K25
date: 2025-01-29
---

## Done() in cancelCtx

``` go
func (c *cancelCtx) Done() <-chan struct{} {
	// Step 1: Try to load the existing `done` channel
	d := c.done.Load()
	if d != nil {
		// If the channel already exists, return it
		return d.(chan struct{})
	}

	// Step 2: Acquire the lock to ensure thread safety
	c.mu.Lock()
	defer c.mu.Unlock()

	// Step 3: Double-check if the `done` channel was created while waiting for the lock
	d = c.done.Load()
	if d == nil {
		// Step 4: Lazily create the `done` channel if it doesn't exist
		d = make(chan struct{})
		c.done.Store(d)
	}

	// Step 5: Return the `done` channel
	return d.(chan struct{})
}
```